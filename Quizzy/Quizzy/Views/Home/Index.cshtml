@{
    ViewData["Title"] = "Home Page";
}

<div class="text-center">
    <img class="logo" src="@Url.Content("~/QuizzyLogo.png")" alt="Quizzy Logo" />

    <h1 class="display-4">Welcome to Quizzy!</h1>
    <p>We are definitely not a ripoff of Kahoot!</p>

    <div id="user-options" class="user-options">
        <a class="btn text-dark btn-primary nav-link" href="/Home/Join">Join a Quiz</a>
    </div>
</div>

<script type="module">
    import { GetFromLocalStorage, localStorageKeys, SetLocalStorage } from '/js/utils.js';

    function logout() {
        SetLocalStorage(localStorageKeys.UserId, null);
        location.reload();
    }

    async function validateStoredUserId() {
        const id = GetFromLocalStorage(localStorageKeys.UserId);
        if (!id) return;

        try {
            const res = await fetch('@Url.Content("~/auth/checkIdInDb")', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(id)
            });

            if (!res.ok) logout()
        } catch {
           logout()
        }
    }

    if (GetFromLocalStorage(localStorageKeys.UserId)) {
        document.getElementById("user-options").innerHTML += `
            <a class="btn text-dark btn-primary nav-link" href="/Home/CreateQuiz">Create a Quiz</a>
            <a class="btn text-dark btn-primary nav-link" href="/Home/QuizSelector">Search Quizzes</a>
            <a class="btn text-dark btn-danger" href="#" id="logoutButton">Logout</a>
        `;
        document.getElementById("logoutButton").addEventListener("click", logout)

        validateStoredUserId();
    } else {
        document.getElementById("user-options").innerHTML += `
            <a class="btn btn-primary text-dark nav-link" href="/Home/Login">Login</a>
            <a class="btn btn-primary text-dark nav-link" href="/Home/Register">Register</a>
        `;
    }
</script>

<style>
    .user-options {
        width: auto;
        min-width: 0;
        padding: 0.375rem 0.75rem;
        margin: 0 0.25rem 0.5rem 0.25rem 0.25rem;
        box-sizing: border-box;
        text-align: center;
        white-space: nowrap;
    }

    .btn {
        display: inline-block;
    }

    .logo {
        max-width: 200px;
        height: auto;
        margin-bottom: 1rem;
    }
</style>